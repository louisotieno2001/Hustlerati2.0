<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hustlerati | Dashboard</title>
    <meta name="description"
        content="Find, compare, and rent commercial spaces tailored to your business needs anytime, anywhere in the world.">
    <meta name="keywords" content="commercial space rental, business space, retail space, warehouse rental, industrial space,
        restaurant space, office space, commercial real estate, business solutions, Hustlerati">
    <meta name="author" content="Hustlerati Team">
    <link rel="icon" href="/images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="light-theme">
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <button class="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="logo">Hustlerati</h1>
            </div>
            <div class="header-right">
                <a href="/list-your-estate"><button class="btn btn-primary list-space-btn">
                        <i class="fas fa-plus"></i> List Space
                    </button></a>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="user-profile">
                <img src="https://picsum.photos/900/200?random=1" alt="User" class="profile-avatar">
                <div class="profile-info">
                    <h4>
                        <%= user.name %>
                    </h4>
                    <p>
                        <%= user.email %>
                    </p>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="active" data-tab="dashboard">
                        <a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    </li>
                    <li data-tab="spaces">
                        <a href="#"><i class="fas fa-store"></i> My Spaces <span class="badge">
                                <%= listedSpaces.length %>
                            </span></a>
                    </li>
                    <li data-tab="bookings">
                        <a href="#"><i class="fas fa-calendar-check"></i> Bookings <span class="badge">
                                <%= activeBookings.length %>
                            </span></a>
                    </li>
                    <li data-tab="orders">
                        <a href="#"><i class="fas fa-shopping-bag"></i> Orders <span class="badge">
                                <%= orders.length %>
                            </span></a>
                    </li>
                    <li data-tab="analytics">
                        <a href="#"><i class="fas fa-chart-line"></i> Analytics</a>
                    </li>
                    <li data-tab="settings">
                        <a href="#"><i class="fas fa-cog"></i> Settings</a>
                    </li>
                    <li>
                        <a href="/"><i class="fas fa-home"></i> Home</a>
                    </li>
                    <li>
                        <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-content">
            <div class="tab-content active" id="dashboard-tab">
                <h2>Dashboard Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-store"></i>
                        <h3>
                            <%= listedSpaces.length %>
                        </h3>
                        <p>Listed Spaces</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <h3>
                            <%= activeBookings.length %>
                        </h3>
                        <p>Active Bookings</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-dollar-sign"></i>
                        <h3><%= monthlyRevenue %> /=
                        </h3>
                        <p>Monthly Revenue</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3>
                            <%= averageRating %>
                        </h3>
                        <p>Average Rating</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>
                            <%= orders.length %>
                        </h3>
                        <p>Total Orders</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3>
                            <%= orders.filter(order=> order.status === 'paid').length %>
                        </h3>
                        <p>Pending Orders</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3>
                            <%= activeBookings.filter(booking=> booking.type === 'group').length %>
                        </h3>
                        <p>Group Bookings</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-user"></i>
                        <h3>
                            <%= activeBookings.filter(booking=> booking.type === 'individual').length %>
                        </h3>
                        <p>Individual Bookings</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <h3>
                            <%= orders.filter(order=> order.status === 'delivered').length %>
                        </h3>
                        <p>Completed Orders</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-times-circle"></i>
                        <h3>
                            <%= orders.filter(order=> order.status === 'cancelled').length %>
                        </h3>
                        <p>Cancelled Orders</p>
                    </div>
                </div>

                <div class="dashboard-charts">
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Recent Activity</h3>
                        <canvas id="activityChart" data-orders='<%- JSON.stringify(orders.slice(0, 10)) %>'
                            data-bookings='<%- JSON.stringify(activeBookings.slice(0, 10)) %>'
                            style="max-height: 200px;"></canvas>
                    </div>
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Space Performance</h3>
                        <canvas id="performanceChart" data-spaces='<%- JSON.stringify(listedSpaces.slice(0, 5)) %>'
                            style="max-height: 200px;"></canvas>
                    </div>
                </div>

                <div class="recent-activity" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: var(--text-color);">Recent Orders</h3>
                    <div class="activity-list"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <% if (orders && orders.length> 0) { %>
                            <% orders.slice(0, 5).forEach(order=> { %>
                                <div class="activity-item"
                                    style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                                    <div>
                                        <strong style="color: var(--text-color);">
                                            <%= order.product ? order.product.name : 'Product' %>
                                        </strong>
                                        <p style="color: var(--text-light); margin: 5px 0;">Quantity: <%= order.quantity
                                                || 1 %> | <%= order.product ? ((order.product.price || 0) *
                                                    (order.quantity || 1)).toFixed(2) : 'N/A' %>
                                        </p>
                                    </div>
                                    <span class="status-badge"
                                        style="padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; background: <%= order.status === 'paid' ? '#4CAF50' : order.status === 'delivered' ? '#2196F3' : '#FF9800' %>; color: white;">
                                        <%= order.status %>
                                    </span>
                                </div>
                                <% }); %>
                                    <% } else { %>
                                        <p style="color: var(--text-light);">No recent orders</p>
                                        <% } %>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="spaces-tab">
                <div class="spaces-body-title">
                    <i class="fa-solid fa-building"></i>
                    <h2>My Spaces</h2>
                </div>

                <div class="space-list">
                    <% if (listedSpaces && listedSpaces.length> 0) { %>
                        <% listedSpaces.forEach(space=> { %>
                            <div class="space-card">
                                <div class="space-image">
                                    <% if (space.image) { %>
                                        <img src="<%= space.image %>" alt="<%= space.title %>">
                                        <% } else { %>
                                            <div class="image-placeholder">
                                                <i class="fas fa-building"></i>
                                            </div>
                                            <% } %>
                                </div>
                                <div class="space-content">
                                    <h4 class="space-title">
                                        <%= space.title %>
                                    </h4>
                                    <p class="space-description">
                                        <%= space.description %>
                                    </p>
                                    <div class="space-meta">
                                        <span class="space-price"><%= space.price %> /= /month</span>
                                        <span class="space-status status-<%= space.status.toLowerCase() %>">
                                            <%= space.status %>
                                        </span>
                                    </div>
                                    <a href="/real_estate/<%= space.id %>" class="btn btn-primary view-details">View
                                        Details</a>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <div class="no-spaces">
                                        <i class="fas fa-building"></i>
                                        <h3>No spaces listed yet.</h3>
                                        <p>Start by listing your first commercial space.</p>
                                        <a href="/list-your-estate" class="btn btn-primary">List Space</a>
                                    </div>
                                    <% } %>
                </div>
            </div>

            <div class="tab-content" id="bookings-tab">
                <div class="bookings-title">
                    <h2>Bookings</h2>
                    <button>
                        <a href="/real_estate">Book a space</a>
                    </button>
                </div>
                <div class="bookings-body">
                    <div class="booking-body-title">
                        <i class="fa-solid fa-user"></i>
                        <h4>Individual Bookings</h4>
                    </div>
                    <div class="divider"></div>
                    <div class="individual-bookings">
                        <% if (activeBookings && activeBookings.length> 0) { %>
                            <% const individualBookings=activeBookings.filter(booking=> booking.type === 'individual');
                                %>
                                <% if (individualBookings.length> 0) { %>
                                    <div class="booking-list">
                                        <% individualBookings.forEach(booking=> { %>
                                            <div class="booking-card">
                                                <div class="booking-image">
                                                    <% if (booking.image) { %>
                                                        <img src="<%= booking.image %>" alt="<%= booking.name %>">
                                                        <% } else { %>
                                                            <div class="image-placeholder">
                                                                <i class="fas fa-building"></i>
                                                            </div>
                                                            <% } %>
                                                </div>
                                                <div class="booking-content">
                                                    <h4 class="booking-title">
                                                        <%= booking.name %>
                                                    </h4>
                                                    <p class="booking-description">
                                                        <%= booking.description || 'No description available' %>
                                                    </p>
                                                    <div class="booking-meta">
                                                        <span class="booking-contribution">Your contribution: <%=
                                                                booking.contribution %> /= </span>
                                                    </div>
                                                    <a href="/real_estate/<%= booking.property_id %>"
                                                        class="btn btn-primary view-details">View Details</a>
                                                </div>
                                            </div>
                                            <% }); %>
                                    </div>
                                    <% } else { %>
                                        <div class="no-bookings">
                                            <i class="fas fa-user"></i>
                                            <h3>No individual bookings yet.</h3>
                                            <p>Start by booking your first individual space.</p>
                                            <a href="/real_estate" class="btn btn-primary">Browse Spaces</a>
                                        </div>
                                        <% } %>
                                            <% } else { %>
                                                <div class="no-bookings">
                                                    <i class="fas fa-user"></i>
                                                    <h3>No individual bookings yet.</h3>
                                                    <p>Start by booking your first individual space.</p>
                                                    <a href="/real_estate" class="btn btn-primary">Browse Spaces</a>
                                                </div>
                                                <% } %>
                    </div>
                    <div class="booking-body-title">
                        <i class="fa-solid fa-user-group"></i>
                        <h4>Group Bookings</h4>
                    </div>
                    <div class="divider"></div>
                    <div class="group-bookings">
                        <% if (activeBookings && activeBookings.length> 0) { %>
                            <% const groupBookings=activeBookings.filter(booking=> booking.type === 'group'); %>
                                <% if (groupBookings.length> 0) { %>
                                    <div class="booking-list">
                                        <% groupBookings.forEach(booking=> { %>
                                            <div class="booking-card">
                                                <div class="booking-image">
                                                    <% if (booking.image) { %>
                                                        <img src="<%= booking.image %>" alt="<%= booking.name %>">
                                                        <% } else { %>
                                                            <div class="image-placeholder">
                                                                <i class="fas fa-building"></i>
                                                            </div>
                                                            <% } %>
                                                </div>
                                                <div class="booking-content">
                                                    <h4 class="booking-title">
                                                        <%= booking.name %>
                                                    </h4>
                                                    <p class="booking-description">
                                                        <%= booking.description || 'No description available' %>
                                                    </p>
                                                    <div class="booking-meta">
                                                        <span class="booking-price"><%= booking.price %> /= /month</span>
                                                        <span class="booking-contribution">Your contribution: <%= booking.contribution %> /=</span>
                                                    </div>
                                                    <a href="/real_estate/<%= booking.property_id %>"
                                                        class="btn btn-primary view-details">View Details</a>
                                                </div>
                                            </div>
                                            <% }); %>
                                    </div>
                                    <% } else { %>
                                        <div class="no-bookings">
                                            <i class="fas fa-user-group"></i>
                                            <h3>No group bookings yet.</h3>
                                            <p>Join or create a group booking for shared spaces.</p>
                                            <a href="/real_estate" class="btn btn-primary">Browse Spaces</a>
                                        </div>
                                        <% } %>
                                            <% } else { %>
                                                <div class="no-bookings">
                                                    <i class="fas fa-user-group"></i>
                                                    <h3>No group bookings yet.</h3>
                                                    <p>Join or create a group booking for shared spaces.</p>
                                                    <a href="/real_estate" class="btn btn-primary">Browse Spaces</a>
                                                </div>
                                                <% } %>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="orders-tab">
                <div class="orders-title">
                    <div class="top">
                        <h2>Orders</h2>
                        <div class="order-actions" style="display: flex; flex-direction: row;">
                            <div class="cart-icon">
                                <a href="/cart" title="Go to Cart">
                                    <i class="fas fa-shopping-cart"></i>
                                    <span class="cart-count">
                                        <%= orders.reduce((sum, order)=> sum + parseInt(order.quantity || 1), 0) %>
                                    </span>
                                </a>
                            </div>
                            <div class="shop-icon">
                                <a href="/shop" title="Go to Shop"><i class="fas fa-store"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <% if (orders && orders.length> 0) { %>
                    <% const ongoingOrders=orders.filter(order=> order.status === 'paid' || order.status ===
                        'delivered'); %>
                        <% const cancelledOrders=orders.filter(order=> order.status === 'cancelled'); %>
                            <div class="sub-tab-nav">
                                <ul class="link-list">
                                    <li class="sub-active" data-sub-tab="ongoing">
                                        <a href="#">Ongoing/Delivered (<%= ongoingOrders.length %>)</a>
                                    </li>
                                    <li data-sub-tab="cancelled">
                                        <a href="#">Cancelled (<%= cancelledOrders.length %>)</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="divider"></div>
                            <div class="sub-tab-content active" id="ongoing-orders">
                                <div class="orders-body">
                                    <% if (ongoingOrders.length> 0) { %>
                                        <% ongoingOrders.forEach(order=> { %>
                                            <div class="order-card">
                                                <div class="order-image">
                                                    <% if (order.product && order.product.media &&
                                                        order.product.media.length> 0) { %>
                                                        <% const media=order.product.media[0]; %>
                                                            <% if (media.id) { %>
                                                                <% const mediaUrl=media.url || `/assets/${media.id}`; %>
                                                                    <% const filename=media.filename_download ||
                                                                        media.filename_disk || '' ; %>
                                                                        <% if (filename.endsWith('.mp4') ||
                                                                            filename.endsWith('.webm') ||
                                                                            filename.endsWith('.ogg') ||
                                                                            filename.endsWith('.mov')) { %>
                                                                            <video class="order-media" controls
                                                                                preload="metadata">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/mp4">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/webm">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/ogg">
                                                                                Your browser does not support the video
                                                                                tag.
                                                                            </video>
                                                                            <% } else if (filename.endsWith('.jpg') ||
                                                                                filename.endsWith('.jpeg') ||
                                                                                filename.endsWith('.png') ||
                                                                                filename.endsWith('.gif') ||
                                                                                filename.endsWith('.webp')) { %>
                                                                                <img class="order-media"
                                                                                    src="<%= mediaUrl %>"
                                                                                    alt="<%= order.product ? order.product.name : 'Product' %>"
                                                                                    loading="lazy"
                                                                                    onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                                                                                <div class="media-fallback"
                                                                                    style="display:none;">
                                                                                    <i class="fas fa-image"></i>
                                                                                    <span>Image Preview
                                                                                        Unavailable</span>
                                                                                </div>
                                                                                <% } else { %>
                                                                                    <div class="media-fallback">
                                                                                        <i class="fas fa-file-alt"></i>
                                                                                        <span>Media Preview</span>
                                                                                    </div>
                                                                                    <% } %>
                                                                                        <% if
                                                                                            (order.product.media.length>
                                                                                            1) { %>
                                                                                            <div class="image-overlay">
                                                                                                <i
                                                                                                    class="fas fa-images"></i>
                                                                                                <span>+<%=
                                                                                                        order.product.media.length
                                                                                                        - 1 %>
                                                                                                        more</span>
                                                                                            </div>
                                                                                            <div class="image-popup">
                                                                                                <button
                                                                                                    class="popup-close">&times;</button>
                                                                                                <div
                                                                                                    class="popup-carousel">
                                                                                                    <% order.product.media.forEach(function(mediaItem,
                                                                                                        index) { %>
                                                                                                        <% const
                                                                                                            itemUrl=mediaItem.url
                                                                                                            ||
                                                                                                            `/assets/${mediaItem.id}`;
                                                                                                            %>
                                                                                                            <% const
                                                                                                                itemFilename=mediaItem.filename_download
                                                                                                                ||
                                                                                                                mediaItem.filename_disk
                                                                                                                || '' ;
                                                                                                                %>
                                                                                                                <% if
                                                                                                                    (itemFilename.endsWith('.mp4')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.webm')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.ogg')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.mov'))
                                                                                                                    { %>
                                                                                                                    <video
                                                                                                                        src="<%= itemUrl %>"
                                                                                                                        class="<%= index === 0 ? 'active' : '' %>"
                                                                                                                        controls></video>
                                                                                                                    <% } else
                                                                                                                        {
                                                                                                                        %>
                                                                                                                        <img src="<%= itemUrl %>"
                                                                                                                            alt="<%= order.product ? order.product.name : 'Product' %> <%= index + 1 %>"
                                                                                                                            class="<%= index === 0 ? 'active' : '' %>">
                                                                                                                        <% }
                                                                                                                            %>
                                                                                                                            <% });
                                                                                                                                %>
                                                                                                </div>
                                                                                                <button
                                                                                                    class="carousel-prev"><i
                                                                                                        class="fas fa-chevron-left"></i></button>
                                                                                                <button
                                                                                                    class="carousel-next"><i
                                                                                                        class="fas fa-chevron-right"></i></button>
                                                                                            </div>
                                                                                            <% } %>
                                                                                                <% } else { %>
                                                                                                    <div
                                                                                                        class="media-fallback">
                                                                                                        <i
                                                                                                            class="fas fa-shopping-bag"></i>
                                                                                                        <span>Order
                                                                                                            Item</span>
                                                                                                    </div>
                                                                                                    <% } %>
                                                                                                        <% } else { %>
                                                                                                            <div
                                                                                                                class="media-fallback">
                                                                                                                <i
                                                                                                                    class="fas fa-shopping-bag"></i>
                                                                                                                <span>Order
                                                                                                                    Item</span>
                                                                                                            </div>
                                                                                                            <% } %>
                                                </div>
                                                <div class="order-details">
                                                    <h4>
                                                        <%= order.product ? order.product.name : 'Product ID: ' +
                                                            order.product_id %>
                                                    </h4>
                                                    <p><%- order.product && order.product.description ?
                                                            order.product.description.substring(0, 150) + '...'
                                                            : 'No description available' %></p>
                                                    <p><strong>Price:</strong> <%= order.product ? order.product.price
                                                            : 'N/A' %> /=
                                                    </p>
                                                    <p><strong>Quantity:</strong>
                                                        <%= order.quantity || 1 %>
                                                    </p>
                                                    <p><strong>Total:</strong> <%= order.product ?
                                                            ((order.product.price || 0) * (order.quantity ||
                                                            1)).toFixed(2) : 'N/A' %> /=
                                                    </p>
                                                    <% if (order.shop) { %>
                                                        <p><strong>Location:</strong>
                                                            <%= order.shop.city || 'N/A' %>
                                                        </p>
                                                        <% if (order.shop.map_location) { %>
                                                            <p><strong>Map:</strong> <a
                                                                    href="<%= order.shop.map_location %>"
                                                                    target="_blank">View on Map</a></p>
                                                            <% } %>
                                                                <% } %>
                                                                    <p><strong>Status:</strong>
                                                                        <%= order.status %>
                                                                    </p>
                                                                    <% if (order.status==='paid' ) { %>
                                                                        <button class="btn btn-outline cancel-order"
                                                                            data-id="<%= order.id %>">
                                                                            <i class="fas fa-times"></i> Cancel Order
                                                                        </button>
                                                                        <% } %>
                                                </div>
                                            </div>
                                            <% }); %>
                                                <% } else { %>
                                                    <p>No ongoing orders.</p>
                                                    <% } %>
                                </div>
                            </div>
                            <div class="sub-tab-content" id="cancelled-orders">
                                <div class="orders-body">
                                    <% if (cancelledOrders.length> 0) { %>
                                        <% cancelledOrders.forEach(order=> { %>
                                            <div class="order-card">
                                                <div class="order-image">
                                                    <% if (order.product && order.product.media &&
                                                        order.product.media.length> 0) { %>
                                                        <% const media=order.product.media[0]; %>
                                                            <% if (media.id) { %>
                                                                <% const mediaUrl=media.url || `/assets/${media.id}`; %>
                                                                    <% const filename=media.filename_download ||
                                                                        media.filename_disk || '' ; %>
                                                                        <% if (filename.endsWith('.mp4') ||
                                                                            filename.endsWith('.webm') ||
                                                                            filename.endsWith('.ogg') ||
                                                                            filename.endsWith('.mov')) { %>
                                                                            <video class="order-media" controls
                                                                                preload="metadata">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/mp4">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/webm">
                                                                                <source src="<%= mediaUrl %>"
                                                                                    type="video/ogg">
                                                                                Your browser does not support the video
                                                                                tag.
                                                                            </video>
                                                                            <% } else if (filename.endsWith('.jpg') ||
                                                                                filename.endsWith('.jpeg') ||
                                                                                filename.endsWith('.png') ||
                                                                                filename.endsWith('.gif') ||
                                                                                filename.endsWith('.webp')) { %>
                                                                                <img class="order-media"
                                                                                    src="<%= mediaUrl %>"
                                                                                    alt="<%= order.product ? order.product.name : 'Product' %>"
                                                                                    loading="lazy"
                                                                                    onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                                                                                <div class="media-fallback"
                                                                                    style="display:none;">
                                                                                    <i class="fas fa-image"></i>
                                                                                    <span>Image Preview
                                                                                        Unavailable</span>
                                                                                </div>
                                                                                <% } else { %>
                                                                                    <div class="media-fallback">
                                                                                        <i class="fas fa-file-alt"></i>
                                                                                        <span>Media Preview</span>
                                                                                    </div>
                                                                                    <% } %>
                                                                                        <% if
                                                                                            (order.product.media.length>
                                                                                            1) { %>
                                                                                            <div class="image-overlay">
                                                                                                <i
                                                                                                    class="fas fa-images"></i>
                                                                                                <span>+<%=
                                                                                                        order.product.media.length
                                                                                                        - 1 %>
                                                                                                        more</span>
                                                                                            </div>
                                                                                            <div class="image-popup">
                                                                                                <button
                                                                                                    class="popup-close">&times;</button>
                                                                                                <div
                                                                                                    class="popup-carousel">
                                                                                                    <% order.product.media.forEach(function(mediaItem,
                                                                                                        index) { %>
                                                                                                        <% const
                                                                                                            itemUrl=mediaItem.url
                                                                                                            ||
                                                                                                            `/assets/${mediaItem.id}`;
                                                                                                            %>
                                                                                                            <% const
                                                                                                                itemFilename=mediaItem.filename_download
                                                                                                                ||
                                                                                                                mediaItem.filename_disk
                                                                                                                || '' ;
                                                                                                                %>
                                                                                                                <% if
                                                                                                                    (itemFilename.endsWith('.mp4')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.webm')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.ogg')
                                                                                                                    ||
                                                                                                                    itemFilename.endsWith('.mov'))
                                                                                                                    { %>
                                                                                                                    <video
                                                                                                                        src="<%= itemUrl %>"
                                                                                                                        class="<%= index === 0 ? 'active' : '' %>"
                                                                                                                        controls></video>
                                                                                                                    <% } else
                                                                                                                        {
                                                                                                                        %>
                                                                                                                        <img src="<%= itemUrl %>"
                                                                                                                            alt="<%= order.product ? order.product.name : 'Product' %> <%= index + 1 %>"
                                                                                                                            class="<%= index === 0 ? 'active' : '' %>">
                                                                                                                        <% }
                                                                                                                            %>
                                                                                                                            <% });
                                                                                                                                %>
                                                                                                </div>
                                                                                                <button
                                                                                                    class="carousel-prev"><i
                                                                                                        class="fas fa-chevron-left"></i></button>
                                                                                                <button
                                                                                                    class="carousel-next"><i
                                                                                                        class="fas fa-chevron-right"></i></button>
                                                                                            </div>
                                                                                            <% } %>
                                                                                                <% } else { %>
                                                                                                    <div
                                                                                                        class="media-fallback">
                                                                                                        <i
                                                                                                            class="fas fa-shopping-bag"></i>
                                                                                                        <span>Order
                                                                                                            Item</span>
                                                                                                    </div>
                                                                                                    <% } %>
                                                                                                        <% } else { %>
                                                        <div class="media-fallback">
                                                            <i class="fas fa-shopping-bag"></i><span>Order Item</span>
                                                        </div>
                                                    <% } %>
                                                </div>
                                                <div class="order-details">
                                                    <h4>
                                                        <%= order.product ? order.product.name : 'Product ID: ' +
                                                            order.product_id %>
                                                    </h4>
                                                    <p><%- order.product && order.product.description ?
                                                            order.product.description.substring(0, 150) + '...'
                                                            : 'No description available' %></p>
                                                    <p><strong>Price:</strong> <%= order.product ? order.product.price
                                                            : 'N/A' %> /=
                                                    </p>
                                                    <p><strong>Quantity:</strong>
                                                        <%= order.quantity || 1 %>
                                                    </p>
                                                    <p><strong>Total:</strong> <%= order.product ?
                                                            ((order.product.price || 0) * (order.quantity ||
                                                            1)).toFixed(2) : 'N/A' %> /=
                                                    </p>
                                                    <% if (order.shop) { %>
                                                        <p><strong>Location:</strong>
                                                            <%= order.shop.pam_location || 'N/A' %>
                                                        </p>
                                                        <% if (order.shop.map_location) { %>
                                                            <p><strong>Map:</strong> <a
                                                                    href="<%= order.shop.map_location %>"
                                                                    target="_blank">View on Map</a></p>
                                                    <% } %>
                                                <% } %>
                                                <p><strong>Status:</strong>   <%= order.status %></p>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <p>No cancelled orders.</p>
                            <% } %>
                        </div>
                    </div>
                <% } else { %>
                    <p>No orders yet.</p>
                <% } %>
            </div>

            <div class="tab-content" id="analytics-tab">
                <h2 class="analytics-title">Analytics</h2>
                <div class="analytics-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Order Status Distribution</h3>
                        <canvas id="orderStatusChart" data-orders='<%- JSON.stringify(orders) %>'
                            style="max-width: 250px; max-height: 250px;"></canvas>
                    </div>
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Monthly Revenue</h3>
                        <canvas id="revenueChart" data-revenue='<%= monthlyRevenue %>'></canvas>
                    </div>
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Spaces Status</h3>
                        <canvas id="spacesStatusChart" data-spaces='<%- JSON.stringify(listedSpaces) %>'></canvas>
                    </div>
                    <div class="chart-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Bookings by Type</h3>
                        <canvas id="bookingsTypeChart" data-bookings='<%- JSON.stringify(activeBookings) %>'
                            style="max-width: 250px; max-height: 250px;"></canvas>
                    </div>
                    <div class="table-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Listed Spaces</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--background-color);">
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Title</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Price</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% listedSpaces.forEach(space=> { %>
                                    <tr>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= space.title %>
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= space.price %> /=
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= space.status %>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                    </div>
                    <div class="table-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Active Bookings</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--background-color);">
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Name</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Price</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Type</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% activeBookings.forEach(booking=> { %>
                                    <tr>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= booking.name %>
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= booking.price %> /=
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= booking.type %>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                    </div>
                    <div class="table-container"
                        style="background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px; color: var(--text-color);">Orders Summary</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--background-color);">
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Product</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Quantity</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Total</th>
                                    <th
                                        style="padding: 10px; text-align: left; border: 1px solid var(--border-color); color: var(--text-color);">
                                        Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% orders.forEach(order=> { %>
                                    <tr>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= order.product ? order.product.name : 'N/A' %>
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= order.quantity || 1 %>
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= order.product ? ((order.product.price || 0) * (order.quantity ||
                                                1)).toFixed(2) : 'N/A' %> /=
                                        </td>
                                        <td
                                            style="padding: 10px; border: 1px solid var(--border-color); color: var(--text-color);">
                                            <%= order.status %>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="settings-tab">
                <h2 class="settings-title">Settings</h2>
                <div class="settings-container">
                    <div class="user-info">
                        <!-- <h3>User Profile</h3> -->
                        <div class="cover-image">
                            <img id="cover-preview"
                                src="<%= user.cover_image || 'https://picsum.photos/900/200?random=1' %>"
                                alt="Cover Image">

                            <input type="file" id="cover-upload" accept="image/*" style="display: none;">
                            <button class="cover-edit-btn"><i class="fas fa-camera"></i></button>

                        </div>
                        <div class="profile-picture">
                            <img id="profile-preview"
                                src="<%= user.profile_image || 'https://picsum.photos/900/200?random=1' %>"
                                alt="Profile Picture">

                            <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                            <button class="profile-edit-btn"><i class="fas fa-camera"></i></button>
                        </div>


                        <div class="user-form-container">
                            <form id="user-form">
                                <div class="form-group">
                                    <label for="name">Name</label>
                                    <input type="text" id="name" name="name" value="<%= user.name %>" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" value="<%= user.email %>" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone</label>
                                    <input type="tel" id="phone" name="phone" value="<%= user.phone || '' %>" readonly>
                                </div>
                                <!-- Add other fields as needed -->
                                <button type="button" id="edit-btn" class="btn btn-primary">Edit Profile</button>
                                <button type="submit" id="save-btn" class="btn btn-success" style="display: none;">Save
                                    Changes</button>
                                <button type="button" id="cancel-btn" class="btn btn-outline"
                                    style="display: none;">Cancel</button>
                            </form>
                        </div>
                    </div>
                    <div class="preferences">
                        <h3>Preferences</h3>
                        <div class="form-group">
                            <label for="theme-select">Select Theme</label>
                            <select id="theme-select" name="theme-select">
                                <option value="light" <%= user.preferences && user.preferences.theme === 'light' ? 'selected' : '' %>>Light</option>
                                <option value="dark" <%= user.preferences && user.preferences.theme === 'dark' ? 'selected' : '' %>>Dark</option>
                                <option value="elegant" <%= user.preferences && user.preferences.theme === 'elegant' ? 'selected' : '' %>>Elegant</option>
                                <option value="minimal" <%= user.preferences && user.preferences.theme === 'minimal' ? 'selected' : '' %>>Minimal</option>
                                <option value="professional" <%= user.preferences && user.preferences.theme === 'professional' ? 'selected' : '' %>>Professional</option>
                                <option value="industrial" <%= user.preferences && user.preferences.theme === 'industrial' ? 'selected' : '' %>>Industrial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pref-email">Email</label>
                            <input type="email" id="pref-email" value="<%= user.email %>" readonly>
                            <button id="verify-email-btn" class="btn btn-outline"
                                style="display: <%= (new Date() - new Date(user.last_email_verification || 0)) > 6*30*24*60*60*1000 ? 'inline-block' : 'none' %>;">Verify
                                Email</button>
                        </div>
                        <div class="form-group">
                            <label for="pref-phone">Phone</label>
                            <input type="tel" id="pref-phone" value="<%= user.phone || '' %>" readonly>
                            <button id="verify-phone-btn" class="btn btn-outline"
                                style="display: <%= (new Date() - new Date(user.last_phone_verification || 0)) > 6*30*24*60*60*1000 ? 'inline-block' : 'none' %>;">Verify
                                Phone</button>
                        </div>
                        <div class="form-group">
                            <div class="preferences-item">
                                <label for="dark-theme-toggle">Dark Theme</label>
                                <input type="checkbox" id="dark-theme-toggle" <%=user.preferences &&
                                    user.preferences.dark_theme ? 'checked' : '' %>>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="preferences-item">
                                <label for="email-verifications-toggle">Email Notifications</label>
                                <input type="checkbox" id="email-verifications-toggle" <%=user.preferences &&
                                    user.preferences.email_verifications ? 'checked' : '' %>>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Custom Popup Modal -->
    <div id="custom-popup" class="custom-popup">
        <div class="popup-content">
            <span class="popup-close">&times;</span>
            <div id="popup-message"></div>
            <div class="popup-buttons">
                <button id="popup-ok" class="btn btn-primary">OK</button>
                <button id="popup-cancel" class="btn btn-outline" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>
    <script src="/javascript/accessibility.js"></script>
    <script src="/javascript/dashboard.js"></script>
    <script src="/javascript/localization.js"></script>
</body>

</html>